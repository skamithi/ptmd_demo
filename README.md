PTM Demo
========

Ansible playbook to setup sandbox for me to test Cumulus Network's PTM Daemon.
Creates 4 VMs with 2 NICs. Attaches the 2 NICs to bridges configured on the KVM
Host. I would like the connections to be point-to-point but i'm still learning
QEMU netdev setup. Right now I'm just using libvirt netdev setting of 'tap'.
I've read using QEMU netdev setting of 'socket' would provide the point to point
setting I need. Haven't figured that out yet.

Topology
--------
* Logical Topology

<pre>

|------|     |--------|
| VM1  |-----|  VM2   |
|------|     |--------|
   |            |
   |            |
   |            |
|------|     |--------|
| VM4  |-----|  VM3   |
|------|     |--------|


</pre>

PreRequisites.
--------------

* Requires Ubuntu 12.04 has KVM host

Runs only on Ubuntu 12.04 for now. Switching to ```virt-builder``` from
  ```vm-builder``` in next rework so I can test this on a debian desktop.

* 4GB disk space in /var/ and 1 GB RAM free

Running it
----------

Host checking needs to be disabled because of all the changes the VMs undergo
during the creation process.

````
ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook site.yml

````
Output
-------

topology.dot autogenerated by ansible playbook.
File is located on ```/etc/cumulus/ptm.d``` on each host

```
digraph G {
  graph [ hostidtype="hostname", version="1:0",date="10/21/2013"];
    skamithiThinkPad:vnet0 -> vm1:eth0;
    skamithiThinkPad:vnet1 -> vm1:eth1;
    skamithiThinkPad:vnet2 -> vm1:eth2;
    skamithiThinkPad:vnet3 -> vm2:eth0;
    skamithiThinkPad:vnet4 -> vm2:eth1;
    skamithiThinkPad:vnet5 -> vm2:eth2;
    skamithiThinkPad:vnet6 -> vm3:eth0;
    skamithiThinkPad:vnet7 -> vm3:eth1;
    skamithiThinkPad:vnet8 -> vm3:eth2;
    skamithiThinkPad:vnet9 -> vm4:eth0;
    skamithiThinkPad:vnet10 -> vm4:eth1;
    skamithiThinkPad:vnet11 -> vm4:eth2;
}
```
ptmctl output from the KVM Host
```
$ ptmctl
---------------------------------------------------------------------
Port   Status Expected Nbr         Observed Nbr         Last Updated
---------------------------------------------------------------------
vnet0  pass   vm1:eth0             vm1:eth0              1m:54s
vnet1  pass   vm1:eth1             vm1:eth1              1m:54s
vnet2  pass   vm1:eth2             vm1:eth2              1m:53s
vnet3  pass   vm2:eth0             vm2:eth0              1m:53s
vnet4  pass   vm2:eth1             vm2:eth1              1m:53s
vnet5  pass   vm2:eth2             vm2:eth2              1m:53s
vnet6  pass   vm3:eth0             vm3:eth0              1m:53s
vnet7  pass   vm3:eth1             vm3:eth1              1m:53s
vnet8  pass   vm3:eth2             vm3:eth2              1m:53s
vnet9  pass   vm4:eth0             vm4:eth0              1m:53s
vnet10 pass   vm4:eth1             vm4:eth1              1m:53s
vnet11 pass   vm4:eth2             vm4:eth2              1m:53s

```

ptmctl output from VM1
```
root@vm1:~# ptmctl
---------------------------------------------------------------------
Port   Status Expected Nbr         Observed Nbr         Last Updated
---------------------------------------------------------------------
eth0   pass   skamithiThinkPad:vnet0 skamithiThinkPad:vnet0  4m:14s
eth1   pass   skamithiThinkPad:vnet1 skamithiThinkPad:vnet1  4m:14s
eth2   pass   skamithiThinkPad:vnet2 skamithiThinkPad:vnet2  4m:14s
```



Todo
----

Write Ruby on Rails app first using graphviz to render the topology and than
after that leverage SVG, probably RaphaelJS and other libs. Web app will show
live changes in the topology has ```if-topo-pass``` and ```if-topo-fail``` get
activated.


